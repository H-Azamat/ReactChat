(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[6],{50:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return d}));var r=a(51),n=a.n(r),s=a(52),c=a(32),u=(a(35),c.a.firestore()),i={signIn:function(){var e=Object(s.a)(n.a.mark((function e(t,a,r,s){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,c.a.auth().signInWithEmailAndPassword(a,r).then((function(e){var t=e.user;t&&t.emailVerified?s(!0):alert("\u041d\u0435 \u0432\u0435\u0440\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u043b\u0438 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u043d\u0435 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d")})).catch((function(e){alert("\u041d\u0435 \u0432\u0435\u0440\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u043b\u0438 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u043d\u0435 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d")}));case 3:case"end":return e.stop()}}),e)})));return function(t,a,r,n){return e.apply(this,arguments)}}(),register:function(){var e=Object(s.a)(n.a.mark((function e(t,a,r,s,u){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,c.a.auth().createUserWithEmailAndPassword(a.trim(),r.trim()).then((function(e){var t=e.user;t.updateProfile({displayName:s}),t.sendEmailVerification().then((function(){u(!0)})).catch((function(e){alert(e.message)}))})).catch((function(e){throw alert(e.message),e}));case 3:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s){return e.apply(this,arguments)}}(),sendEmail:function(){var e=Object(s.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.a.auth().currentUser,e.next=3,a.sendEmailVerification().then((function(){t(!0)})).catch((function(e){alert(e.message)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),logout:function(){var e=Object(s.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.a.auth().signOut();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},o={sendMessage:function(){var e=Object(s.a)(n.a.mark((function e(t,a,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,u.collection("messages").add({message:t,id:r,date:a,key:new Date});case 3:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}()},d={updateProfile:function(){var e=Object(s.a)(n.a.mark((function e(t,a,r){var s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.a.auth().currentUser,e.next=3,s.updateProfile({displayName:a,photoURL:t}).then((function(){r(s.uid,a,t,!0)}));case 3:u.collection("users").doc(s.uid).update({username:a,img:t}).then((function(){r(s.uid,a,t,!0)}));case 4:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),getUserProfile:function(){var e=Object(s.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.collection("users").doc(t).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},55:function(e,t,a){"use strict";t.a=a.p+"static/media/userImg.c9678b2f.svg"},56:function(e,t,a){"use strict";var r=a(20),n=a.p+"static/media/Logo.812a9abb.svg",s=(a(50),a(55)),c=a(25),u=a(4);t.a=Object(r.b)((function(e){return{username:e.currentUser.username,userImg:e.currentUser.userImg}}))((function(e){var t=e.username,a=e.userImg;return Object(u.jsxs)("div",{className:"header",children:[Object(u.jsx)("img",{src:n,alt:"ReactChat",className:"header-logo"}),Object(u.jsx)("div",{className:"header-info",children:Object(u.jsxs)(c.b,{to:"/profile",className:"header-toProfile",children:[Object(u.jsx)("span",{className:"header-username",children:t}),Object(u.jsx)("img",{src:a||s.a,alt:"imgProfile",className:"header-img"})]})})]})}))},64:function(e,t,a){"use strict";a.r(t);var r=a(57),n=a(58),s=a(60),c=a(59),u=a(1),i=a(53),o=a(6),d=a(32),f=(a(35),a(56)),m=a(20),l=a(15),j=a(25),b=a(55),h=a(4),p=function(e){return Object(h.jsxs)("div",{className:"chat-message__block ".concat(e.currentUserId===e.userId?"my-message__block":""),children:[Object(h.jsx)("img",{src:e.avatar||b.a,alt:"avatar",className:"message-avatar"}),Object(h.jsxs)("div",{className:"chat-message ".concat(e.currentUserId===e.userId?"my-message":""),children:[e.currentUserId!==e.userId&&Object(h.jsx)(j.b,{to:"/profile/"+e.userId,className:"chat-message-username",children:e.username}),Object(h.jsx)("p",{className:"chat-message-text",children:e.message}),Object(h.jsx)("span",{className:"chat-message-date",children:e.date})]})]})},g=a(21),v=d.a.firestore(),O=Object(m.b)((function(e){return{messages:e.messages,users:e.users,id:e.currentUser.uid}}),{updateMessages:g.d})((function(e){var t=Object(u.useState)(!0),a=Object(i.a)(t,2),r=a[0],n=a[1],s=Object(u.useState)(15),c=Object(i.a)(s,2),o=c[0],d=c[1],f=function(t){return e.users.filter((function(e){return e.userId===t}))[0]};Object(u.useEffect)((function(){var t=v.collection("messages").orderBy("key","asc").limitToLast(o).onSnapshot((function(t){var a=[];t.forEach((function(e){return a.push({userId:e.data().id,message:e.data().message,avatar:e.data().avatar,username:e.data().username,date:e.data().date,key:e.data().key})})),e.updateMessages(a),n(!1)}));return function(){t()}}),[o]);var m=Object(u.useRef)(null);m.current&&15===o&&setTimeout((function(){m.current.scrollTop=m.current.scrollHeight}),1);return Object(h.jsx)("div",{onScroll:function(){0===m.current.scrollTop&&d(o+15)},className:"chat-messages",ref:m,children:r?Object(h.jsx)(l.a,{}):Object(h.jsx)("div",{children:e.messages.map((function(t){return Object(h.jsx)(p,{userId:t.userId,avatar:f(t.userId).img,message:t.message,username:f(t.userId).username,currentUserId:e.id,date:t.date},t.key)}))})})})),x=a(51),k=a.n(x),w=a(52),y=a(50),N=a(61),I=a.n(N),S=a.p+"static/media/send.a5a3638c.svg",U=a.p+"static/media/emoji.c9daaafd.svg",E=function(e){var t=e.id,a=Object(u.useState)(""),r=Object(i.a)(a,2),n=r[0],s=r[1],c=Object(u.useState)(!1),o=Object(i.a)(c,2),d=o[0],f=o[1],m=function(){var e=Object(w.a)(k.a.mark((function e(a){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,y.b.sendMessage(n,l(),s,t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,r=e.getHours(),n=e.getMinutes();switch(a){case 1:a="\u042f\u043d\u0432\u0430\u0440\u044c";break;case 2:a="\u0424\u0435\u0432\u0440\u0430\u043b\u044c";break;case 3:a="\u041c\u0430\u0440\u0442";break;case 4:a="\u0410\u043f\u0440\u0435\u043b\u044c";break;case 5:a="\u041c\u0430\u0439";break;case 6:a="\u0418\u044e\u043b\u044c";break;case 7:a="\u0418\u044e\u043d\u044c";break;case 8:a="\u0410\u0432\u0433\u0443\u0441\u0442";break;case 9:a="\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c";break;case 10:a="\u041e\u043a\u0442\u044f\u0431\u0440\u044c";break;case 11:a="\u041d\u043e\u044f\u0431\u0440\u044c";break;case 12:a="\u0414\u0435\u043a\u0430\u0431\u0440\u044c";break;default:return""}return t+" "+a+" "+r+":"+n};return Object(h.jsxs)("form",{className:"formSending",onSubmit:function(e){return m(e)},children:[Object(h.jsxs)("div",{className:"formSending-emoji",children:[Object(h.jsx)("div",{onClick:function(){return f(!d)},className:"formSending-emoji-open",children:Object(h.jsx)("img",{width:"28",src:U,alt:"emoji"})}),d&&Object(h.jsx)("div",{className:"formSending-emoji-modal",children:Object(h.jsx)(I.a,{onEmojiClick:function(e,t){s(n+t.emoji)}})})]}),Object(h.jsx)("input",{type:"text",value:n,className:"formSending-field",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",onChange:function(e){s(e.target.value)}}),Object(h.jsx)("button",{className:"formSending-submit",children:Object(h.jsx)("img",{src:S,alt:"submit",className:"formSending-submit__img"})})]})},M=function(e){var t=Object(u.useState)(!1),a=Object(i.a)(t,2),r=a[0],n=a[1],s=Object(u.useState)(""),c=Object(i.a)(s,2),m=(c[0],c[1]);return Object(u.useEffect)((function(){d.a.auth().onAuthStateChanged((function(e){e&&e.emailVerified?(n(!1),m(e.displayName)):n(!0)}))}),[]),r?Object(h.jsx)(o.a,{to:"login"}):Object(h.jsxs)("div",{className:"chat",children:[Object(h.jsx)(f.a,{}),Object(h.jsx)(O,{}),Object(h.jsx)(E,{id:e.id})]})},P=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(n.a)(a,[{key:"getMessages",value:function(){var e=this;v.collection("users").onSnapshot((function(t){var a=[];t.forEach((function(e){return a.push({userId:e.data().userId,img:e.data().img,username:e.data().username})})),e.props.setUsers(a)}))}},{key:"componentDidMount",value:function(){this.getMessages()}},{key:"render",value:function(){return Object(h.jsx)(M,{})}}]),a}(u.Component);t.default=Object(m.b)((function(e){return{id:e.currentUser.uid}}),{setUsers:g.c,setCurrentUser:g.b})(P)}}]);
//# sourceMappingURL=6.69650c81.chunk.js.map